{
  "title": "Deploy and Celebrate",
  "objectives": [
    "Deploy your agent to Amazon Bedrock AgentCore",
    "Configure production settings for reliability and security",
    "Share your accomplishment and plan next steps"
  ],
  "content": "# Deploy and Celebrate\n\nYou've built something real. Now let's put it in production where it can help actual users.\n\nThis lesson covers deployment to AgentCore, production configuration, and celebrating your achievement.\n\n## Pre-Deployment Checklist\n\nBefore deploying, verify:\n\n```\nâ˜ All tests passing\nâ˜ No hardcoded secrets in code\nâ˜ Error handling for all failure modes\nâ˜ Rate limiting considered\nâ˜ Logging configured\nâ˜ IAM permissions reviewed (least privilege)\nâ˜ Cost estimation done\n```\n\n## Step 1: Prepare for Production\n\n### Environment Configuration\n\nSeparate configuration from code:\n\n```python\n# src/config.py\nimport os\nfrom dataclasses import dataclass\n\n@dataclass\nclass Config:\n    # Required\n    aws_region: str = os.getenv(\"AWS_REGION\", \"us-east-1\")\n    model_id: str = os.getenv(\"MODEL_ID\", \"anthropic.claude-3-sonnet-20240229-v1:0\")\n    \n    # Tuning\n    max_tokens: int = int(os.getenv(\"MAX_TOKENS\", \"1024\"))\n    temperature: float = float(os.getenv(\"TEMPERATURE\", \"0.7\"))\n    memory_window: int = int(os.getenv(\"MEMORY_WINDOW\", \"10\"))\n    \n    # Operational\n    log_level: str = os.getenv(\"LOG_LEVEL\", \"INFO\")\n    enable_tracing: bool = os.getenv(\"ENABLE_TRACING\", \"true\").lower() == \"true\"\n    \n    # Safety\n    max_requests_per_minute: int = int(os.getenv(\"MAX_RPM\", \"60\"))\n    request_timeout: int = int(os.getenv(\"REQUEST_TIMEOUT\", \"30\"))\n\nconfig = Config()\n```\n\n### Logging Setup\n\n```python\n# src/logging_config.py\nimport logging\nimport json\nfrom datetime import datetime\n\nclass JSONFormatter(logging.Formatter):\n    def format(self, record):\n        log_obj = {\n            \"timestamp\": datetime.utcnow().isoformat(),\n            \"level\": record.levelname,\n            \"message\": record.getMessage(),\n            \"module\": record.module,\n        }\n        if hasattr(record, 'session_id'):\n            log_obj['session_id'] = record.session_id\n        if hasattr(record, 'tool_name'):\n            log_obj['tool_name'] = record.tool_name\n        return json.dumps(log_obj)\n\ndef setup_logging():\n    logger = logging.getLogger(\"agent\")\n    logger.setLevel(logging.INFO)\n    \n    handler = logging.StreamHandler()\n    handler.setFormatter(JSONFormatter())\n    logger.addHandler(handler)\n    \n    return logger\n```\n\n### Error Handling\n\n```python\n# src/errors.py\nclass AgentError(Exception):\n    \"\"\"Base error for agent issues.\"\"\"\n    def __init__(self, message, recoverable=True):\n        self.message = message\n        self.recoverable = recoverable\n        super().__init__(message)\n\nclass ToolError(AgentError):\n    \"\"\"Error in tool execution.\"\"\"\n    pass\n\nclass RateLimitError(AgentError):\n    \"\"\"Too many requests.\"\"\"\n    def __init__(self):\n        super().__init__(\"Rate limit exceeded. Please try again shortly.\", recoverable=True)\n\ndef safe_chat(agent, message, session_id):\n    \"\"\"Wrapper with error handling.\"\"\"\n    try:\n        return agent.chat(message, session_id)\n    except RateLimitError:\n        return \"I'm receiving a lot of requests right now. Please try again in a moment.\"\n    except ToolError as e:\n        logger.error(f\"Tool error: {e}\", extra={'session_id': session_id})\n        return \"I had trouble completing that action. Let me try a different approach.\"\n    except Exception as e:\n        logger.exception(f\"Unexpected error: {e}\", extra={'session_id': session_id})\n        return \"Something went wrong. Please try again or contact support.\"\n```\n\n## Step 2: Deploy to AgentCore\n\n### Create the Agent Definition\n\n```python\n# deploy/agent_definition.py\nimport boto3\nimport json\n\ndef create_agent():\n    client = boto3.client('bedrock-agentcore')\n    \n    # Agent definition\n    agent_config = {\n        \"agentName\": \"my-capstone-agent\",\n        \"description\": \"Customer support agent for handling FAQs and order inquiries\",\n        \"foundationModel\": \"anthropic.claude-3-sonnet-20240229-v1:0\",\n        \"instruction\": open(\"prompts/system_prompt.txt\").read(),\n        \"idleSessionTTL\": 3600,  # 1 hour\n    }\n    \n    response = client.create_agent(**agent_config)\n    agent_id = response['agentId']\n    print(f\"Created agent: {agent_id}\")\n    \n    return agent_id\n\ndef add_tools(agent_id):\n    client = boto3.client('bedrock-agentcore')\n    \n    tools = [\n        {\n            \"name\": \"search_faq\",\n            \"description\": \"Search the FAQ knowledge base for customer questions\",\n            \"parameters\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"query\": {\"type\": \"string\", \"description\": \"Search query\"},\n                    \"category\": {\"type\": \"string\", \"enum\": [\"shipping\", \"returns\", \"billing\"]}\n                },\n                \"required\": [\"query\"]\n            },\n            \"lambdaArn\": \"arn:aws:lambda:us-east-1:123456789:function:search-faq\"\n        },\n        {\n            \"name\": \"get_order_status\",\n            \"description\": \"Get the status of a customer order\",\n            \"parameters\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"order_id\": {\"type\": \"string\", \"pattern\": \"^ORD-[0-9]{6}$\"}\n                },\n                \"required\": [\"order_id\"]\n            },\n            \"lambdaArn\": \"arn:aws:lambda:us-east-1:123456789:function:get-order-status\"\n        }\n    ]\n    \n    for tool in tools:\n        client.create_agent_action_group(\n            agentId=agent_id,\n            actionGroupName=tool[\"name\"],\n            actionGroupExecutor={\"lambda\": tool[\"lambdaArn\"]},\n            functionSchema={\"functions\": [tool]}\n        )\n        print(f\"Added tool: {tool['name']}\")\n\ndef prepare_agent(agent_id):\n    client = boto3.client('bedrock-agentcore')\n    client.prepare_agent(agentId=agent_id)\n    print(\"Agent prepared and ready!\")\n\nif __name__ == \"__main__\":\n    agent_id = create_agent()\n    add_tools(agent_id)\n    prepare_agent(agent_id)\n```\n\n### Deploy Tool Lambda Functions\n\n```python\n# deploy/deploy_tools.py\nimport boto3\nimport zipfile\nimport io\n\ndef create_lambda_deployment_package(source_dir):\n    \"\"\"Create a zip file of the Lambda code.\"\"\"\n    buffer = io.BytesIO()\n    with zipfile.ZipFile(buffer, 'w', zipfile.ZIP_DEFLATED) as zf:\n        for file in Path(source_dir).rglob('*.py'):\n            zf.write(file, file.relative_to(source_dir))\n    buffer.seek(0)\n    return buffer.read()\n\ndef deploy_lambda(function_name, code_path, handler, role_arn):\n    lambda_client = boto3.client('lambda')\n    \n    try:\n        # Update existing\n        lambda_client.update_function_code(\n            FunctionName=function_name,\n            ZipFile=create_lambda_deployment_package(code_path)\n        )\n        print(f\"Updated {function_name}\")\n    except lambda_client.exceptions.ResourceNotFoundException:\n        # Create new\n        lambda_client.create_function(\n            FunctionName=function_name,\n            Runtime='python3.11',\n            Role=role_arn,\n            Handler=handler,\n            Code={'ZipFile': create_lambda_deployment_package(code_path)},\n            Timeout=30,\n            MemorySize=256\n        )\n        print(f\"Created {function_name}\")\n```\n\n## Step 3: Create the Gateway\n\n```python\n# deploy/create_gateway.py\nimport boto3\n\ndef create_agent_gateway(agent_id, agent_alias_id):\n    \"\"\"Create an API Gateway to expose the agent.\"\"\"\n    apigw = boto3.client('apigatewayv2')\n    \n    # Create HTTP API\n    api = apigw.create_api(\n        Name='my-agent-api',\n        ProtocolType='HTTP',\n        Description='API for My Capstone Agent'\n    )\n    \n    # Add route for chat\n    apigw.create_route(\n        ApiId=api['ApiId'],\n        RouteKey='POST /chat',\n        Target=f\"integrations/{create_bedrock_integration(api['ApiId'], agent_id, agent_alias_id)}\"\n    )\n    \n    # Deploy\n    apigw.create_stage(\n        ApiId=api['ApiId'],\n        StageName='prod',\n        AutoDeploy=True\n    )\n    \n    endpoint = f\"{api['ApiEndpoint']}/prod/chat\"\n    print(f\"Agent available at: {endpoint}\")\n    return endpoint\n```\n\n## Step 4: Verify Deployment\n\n```bash\n# Test the deployed agent\ncurl -X POST https://your-api-endpoint/chat \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"message\": \"What is your return policy?\", \"session_id\": \"test-123\"}'\n```\n\nExpected response:\n```json\n{\n  \"response\": \"Our return policy allows you to return any item within 30 days...\",\n  \"session_id\": \"test-123\"\n}\n```\n\n## Step 5: Monitor in Production\n\n### CloudWatch Dashboard\n\nCreate a dashboard to monitor:\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚                   MY AGENT - PRODUCTION                      â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Invocations/min     â”‚ Avg Latency         â”‚ Error Rate      â”‚\nâ”‚        42           â”‚      1.2s           â”‚     0.5%        â”‚\nâ”‚    â–â–‚â–ƒâ–„â–…â–†â–‡â–ˆâ–‡â–†â–…      â”‚   â–â–â–‚â–‚â–ƒâ–ƒâ–‚â–‚â–â–       â”‚   â–â–â–â–â–‚â–â–â–â–    â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ Tool Usage                                                   â”‚\nâ”‚ search_faq: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 78%                   â”‚\nâ”‚ get_order: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 35%                   â”‚\nâ”‚ escalate:  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 8%                    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Alarms to Set\n\n| Metric | Threshold | Action |\n|--------|-----------|--------|\n| Error rate | > 5% for 5 min | Page on-call |\n| Latency p99 | > 10s for 5 min | Investigate |\n| Invocations | > 1000/min | Check for abuse |\n| Lambda errors | > 1% | Check tool health |\n\n## Celebrate Your Achievement! ðŸŽ‰\n\nYou've built and deployed a production AI agent. That's a significant accomplishment.\n\n### What You've Accomplished\n\n- âœ… Defined requirements for a real-world agent\n- âœ… Designed an architecture using AgentCore services\n- âœ… Implemented custom tools that connect to data sources\n- âœ… Tested thoroughly with unit, integration, and e2e tests\n- âœ… Deployed to production on AWS\n- âœ… Set up monitoring and error handling\n\n### Share Your Work\n\n1. **Document your project** - Write a README explaining what you built and why\n2. **Record a demo** - Show your agent in action (2-3 minute video)\n3. **Share the code** - Push to GitHub (remove any secrets first!)\n4. **Tell your story** - Blog post or LinkedIn update about what you learned\n\n### Your Portfolio Piece\n\nThis project demonstrates:\n- Understanding of AI agent architecture\n- Practical AWS and cloud deployment skills\n- Production engineering practices (testing, monitoring, error handling)\n- End-to-end project execution\n\n## What's Next?\n\n### Immediate Improvements\n- Add more tools based on user feedback\n- Improve responses based on conversation logs\n- Add analytics to understand user behavior\n\n### Advanced Extensions\n- Multi-agent orchestration (add a specialist agent)\n- Voice interface (connect to Amazon Lex)\n- Proactive engagement (agent initiates helpful suggestions)\n- A/B testing different prompts or models\n\n### Keep Learning\n- Watch for new AgentCore features\n- Study production agent systems at scale\n- Contribute to open-source agent frameworks\n\n## Final Assignment\n\n1. **Deploy your agent** to AgentCore (even if just for testing)\n2. **Create a README** documenting your project\n3. **Record a 2-minute demo** showing your agent in action\n4. **Write a brief retrospective**: What went well? What was hard? What would you do differently?\n\n## Congratulations!\n\nYou've completed the AgentCore Academy capstone project. You're now equipped to build, deploy, and operate AI agents on AWS.\n\nGo build something amazing. ðŸš€"
}
